# Richlychee 프로젝트 초기 구현 세션

**날짜:** 2026-02-12
**작업 요약:** 네이버 스마트스토어 대량 상품 등록 CLI 도구 전체 구현 + 테스트 + 배포

---

## 1단계: 설계 계획 수립

네이버 커머스 API를 활용한 대량 상품 등록 프로그램의 전체 아키텍처를 설계했다.

- **폴더 구조:** `richlychee/` 패키지 하위에 `auth`, `api`, `data`, `engine`, `utils` 모듈로 분리
- **데이터 흐름:** 엑셀/CSV 입력 → 파싱 → 변환 → 검증 → 이미지 업로드 → 상품 등록 → 결과 리포트
- **CLI 명령어:** `register`, `validate`, `auth-test` 3가지 서브커맨드 지원
- **라이브러리:** requests, bcrypt, pandas, pydantic, rich, tenacity 등 11개 핵심 의존성 선정

---

## 2단계: 전체 코드 구현

총 35개 파일, 2,834줄의 코드를 작성했다.

### 구현한 모듈

| 모듈 | 파일 | 역할 |
|---|---|---|
| `config.py` | 1개 | pydantic-settings 기반 .env + settings.yaml 설정 로딩 |
| `auth/` | 2개 | bcrypt 서명 생성, OAuth2 토큰 발급, 자동 갱신 세션 |
| `api/` | 4개 | HTTP 클라이언트 (레이트 리밋 + 재시도), 상품/이미지/카테고리 API |
| `data/` | 4개 | Pydantic 모델, 엑셀/CSV 리더, 변환기, 검증기 |
| `engine/` | 2개 | 대량 등록 오케스트레이터, 결과 리포트 (Rich 테이블 + 엑셀) |
| `utils/` | 2개 | Rich 기반 구조화 로깅, 토큰 버킷 레이트 리미터 |
| `main.py` | 1개 | argparse CLI 진입점 |
| `tests/` | 5개 | 인증, 리더, 변환기, 검증기 단위 테스트 (41개) |

### 주요 설계 결정

- **Pydantic v2** 모델로 API 페이로드 구조를 엄격하게 정의
- **한글 컬럼명** 자동 매핑 지원 (예: `상품명` → `product_name`)
- **옵션 조합 자동 생성**: 2개 옵션의 모든 조합을 자동으로 만듦
- **tenacity** 라이브러리로 지수 백오프 + 지터 재시도 구현
- **토큰 버킷** 알고리즘으로 네이버 API 레이트 리밋 준수

---

## 3단계: Python 설치 및 테스트

시스템에 Python이 없어서 Python 3.12.8을 직접 설치했다.

```
Python 3.12.8 설치 (C:\Users\desig\Python312)
pip install -e ".[dev]" → 34개 패키지 설치
pytest tests/ → 41 passed, 0 warnings (0.65초)
```

---

## 4단계: dry-run 시연

샘플 엑셀 파일로 전체 파이프라인을 모의 실행했다.

```
1단계: 파일 읽기...     → 3행 읽음
2단계: 데이터 검증...   → 검증 통과 (오류 0, 경고 0)
--dry-run 모드          → 3개 상품 페이로드 생성 확인
```

### 발견한 버그 및 수정

- **문제:** 엑셀에서 `category_id` 컬럼이 정수(int)로 읽혀 Pydantic 문자열 검증 실패
- **원인:** pandas가 숫자만 있는 컬럼을 자동으로 int64로 파싱
- **수정:** `reader.py`의 `_clean_dataframe()`에서 `category_id`, `seller_managed_code`를 str로 강제 변환
- **결과:** 수정 후 3개 상품 모두 정상 변환 확인

---

## 5단계: GitHub 배포

두 번의 커밋으로 GitHub에 푸시했다.

| 커밋 | 메시지 |
|---|---|
| `579ef9e` | feat: 네이버 스마트스토어 대량 상품 등록 CLI 도구 초기 구현 |
| `66f2c65` | fix: 엑셀에서 category_id가 정수로 읽히는 문제 수정 |

**저장소:** https://github.com/juuuno-coder/richlychee

---

## 다음 할 일

1. 네이버 커머스 API 센터에서 `client_id` + `client_secret` 발급
2. 공인 IP 화이트리스트 등록
3. `python -m richlychee auth-test`로 실제 인증 테스트
4. 테스트 상품 1~2개로 실제 등록 확인
